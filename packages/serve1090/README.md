# serve1090

### Overview

`serve1090` scaffolds an `express` server for receiving `dump1090` data via WebSocket; filtering, validating, and aggregating it into an API; and finally, for performing geospatial work using aircraft data to determine which airspaces they are located in and which aircraft are currently arriving or departing a specified airport. Further features are under active development.

### Prerequisites

1. From the repo root, run `chmod +x scripts/setup.sh && ./scripts/setup.sh` and follow prompts
2. Optionally, add OpenSky and FligtAware FlightXML2 username/password pairs to `.env` 

Then, if running via Docker only: 

1. [Docker CLI](https://docs.docker.com/get-docker/)

Alternatively, if running the `express` server outside of a Docker container:

1. Volta: `curl https://get.volta.sh | bash`
2. Node: `volta install node`
3. Yarn: `volta install yarn`

### Installation and execution

`yarn compose` (`docker-compose up -d --build`) will start the entire `serve1090` stack within two `docker` containers, one for the `express` server and one for KeyDB. The `express` server running in the container supports hot reloading.

By default, the app builds under `NODE_ENV=development`. For a production build without hot reloading that uses a performance logger and PM2 for crash recovery, change `NODE_ENV` to `production` in `.env` and run `yarn compose`.

It is possible to directly run `keydb-cli` against the KeyDB instance. SSH into the KeyDB Docker container and run `keydb-cli -a "KEYDB_PASSWORD"` where `KEYDB_PASSWORD` is the password generated by `setup.sh` and stored in `.env`.

See [package.json](package.json) for more info.

### KeyDB and Redis

`serve1090` depends on [KeyDB](https://github.com/JohnSully/KeyDB), a high performance fork of [Redis](https://github.com/redis/redis) with some extra features that are particularly useful for keeping and constantly refreshing an updated data stream of aircraft. Specifically, `serve1090` leverages the `EXPIREMEMBER` command unique to KeyDB that allows for an individual member of a hash or set to be given an expiration time, something that is not possible in Redis and saves a lot of complicated store logic to purge out stale aircraft as the fly out of range of the dependent `dump1090` receiver(s).

`serve1090` will fail to persist aircraft without a properly configured instance of KeyDB exposed on port 6379 (see [keydb.conf.template](keydb.conf.template)). 